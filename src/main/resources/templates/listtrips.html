<div th:replace="fragments/header"></div>

<fieldset>
    <label>
        <input
                type="text"
                id="filterInput"
                onkeyup="myFunction()"
                placeholder="Filter on car"
                title="Type car name">
    </label>
</fieldset>
<fieldset>
<table id="table">
    <thead>
    <tr>
        <th scope="col">Datum</th>
        <th th:if="${role == '[ROLE_ADMIN]'}" scope="col">Persoon</th>
        <th scope="col">Auto</th>
        <th scope="col">km</th>
        <th scope="col">km totaal</th>
        <th scope="col">Liters</th>
        <th scope="col">amount</th>
    </tr>
    </thead>
    <tbody>

    <tr th:each="trip: ${trips}">
        <td scope="col" th:text="${trip.driveDate}"/>
        <td th:if="${role == '[ROLE_ADMIN]'}" scope="col" th:text="${trip.person}"/>
        <td scope="col" th:text="${trip.carType}"/>
        <td scope="col" th:text="${trip.km}"/>
        <td scope="col" th:text="${trip.kmTotal}"/>
        <td scope="col" th:text="${trip.liters}"/>
        <td scope="col" th:text="${trip.amount}"/>
    </tr>
    <tfoot>
    <tr>
        <td scope="col"></td>
        <td th:if="${role == '[ROLE_ADMIN]'}" scope="col"/>
        <td scope="col">Total:</td>
        <td scope="col" th:text="${kmTotal}"/>
        <td scope="col"></td>
        <td scope="col" th:text="${litersTotal}"/>
    </tr>
    </tfoot>
</table>
</fieldset>

<div th:replace="fragments/footer"></div>

<script>
    const myFunction = () => {
        const columns = [
            {name: 'Auto', index: 2, isFilter: true},
            {name: 'Person', index: 1, isFilter: true}
        ]
        const filterColumns = columns.filter(c => c.isFilter).map(c => c.index)
        const trs = document.querySelectorAll('#table tbody tr')

        const filter = document.querySelector('#filterInput').value
        const regex = new RegExp(escape(filter), 'i')
        const isFoundInTds = td => regex.test(td.innerHTML)
        console.log(isFoundInTds)
        const isFound = childrenArr => childrenArr.some(isFoundInTds)
        const setTrStyleDisplay = ({style, children}) => {
            style.display = isFound([
                ...filterColumns.map(c => children[c]) // <-- filter Columns
            ]) ? '' : 'none'
        }

        trs.forEach(setTrStyleDisplay)
    }
</script>